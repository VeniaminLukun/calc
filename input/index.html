<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>calc</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onkeydown="focusInput()" onload="focusInput()">
    <div class="calc_wrap">
        <div class="main_body">
            <div class="input_output">
                <div class="input_wrap">
                    <input type="text" class="input" id="input" value="0" onkeydown="check_enter(event), input_keydown(event)">
                    <button id="c">
                        C
                    </button>
                </div>
                <div class="output_wrap">
                    <input id="output" value="0" disabled></input>
                    <button id="back">⌫</button>
                </div>
            </div>
            <div class="btns">
                <div class="numbers">
                    <div>
                        <button class="num_btn"> 1 </button>
                        <button class="num_btn"> 2 </button>
                        <button class="num_btn"> 3 </button>
                    </div>
                    <div>
                        <button class="num_btn"> 4 </button>
                        <button class="num_btn"> 5 </button>
                        <button class="num_btn"> 6 </button>
                    </div>
                    <div>
                        <button class="num_btn"> 7 </button>
                        <button class="num_btn"> 8 </button>
                        <button class="num_btn"> 9 </button>
                    </div>
                    <div>
                        <button class="oper_btn" id="dot"> . </button>
                        <button class="num_btn" id="0"> 0 </button>
                        <button class="num_btn" id="00"> 000 </button>
                    </div>
                </div>
                <div class="operators">
                    <button class="oper_btn"> + </button>
                    <button class="oper_btn"> - </button>
                    <button class="oper_btn"> * </button>
                    <button class="oper_btn"> / </button>
                    <button id="equal"> = </button>
                </div>
            </div>
        </div>
    </div>
</body>
<script>

    // КОНТРОЛЛЕР ВВОДИМЫХ ЗНАЧЕНИЙ

    function input_keydown(e) {
        if(input.value == "0") {
            input.value = "";
        }
        if (/[^0-9\+\-\*\/\.]/gi.test(e.key)) {
            if(e.key != "Enter" && e.key != "Backspace" && e.key != "F5" && e.key != "F12") {
                e.preventDefault();
            }
        }
        var i = input.value.length;
        if (check_oper(e.key)) {
            if (check_oper(input.value[i-1])) {
                input.value = input.value.replace(input.value[i-1], e.key);
                e.preventDefault();
            }
        }
        if (input.value[i-1] == ".") {
                var dot_count = [];
                var temp_dot = -1;
                var dot_error = false;
                for(i = 0; i < input.value.length; i++) {
                    temp_dot = input.value.indexOf(".", temp_dot + 1);
                    if(temp_dot != -1) {
                        function dot_check() {
                            dot_count.forEach(element => {
                                if(element == temp_dot) {
                                    dot_error = true;
                                }
                            });
                        }
                        dot_check();
                        if(!dot_error) {
                            dot_count.push(temp_dot);
                        }
                    }
                }
                var find_plus = input.value.lastIndexOf("+");
                var find_minus = input.value.lastIndexOf("-"); 
                var find_mult = input.value.lastIndexOf("*");
                var find_div = input.value.lastIndexOf("/");
                dot_arr_l = dot_count[dot_count.length - 1];
                dot_arr_p = dot_count[dot_count.length - 2];
                if(dot_arr_p != undefined) {
                    if((dot_arr_p < find_plus && find_plus < dot_arr_l) || 
                    (dot_arr_p < find_minus && find_minus < dot_arr_l) || 
                    (dot_arr_p < find_mult && find_mult < dot_arr_l) || 
                    (dot_arr_p < find_div && find_div < dot_arr_l)) {
                    } else {
                        input.value = input.value.slice(0, -1);
                    }
                }
                if(dot_count[0] == 0) {
                    input.value = input.value.slice(0, -1);
                }
            }
    }

    // АВТОФОКУС НА ПОЛЕ ВВОДА

    function focusInput() {
        input.focus();
    }

    // ФУНКЦИЯ ПРОВЕРКИ НА ОПЕРАТОРЫ

    function check_oper(check) {
        var opers = ["+", "-", "*", "/", "."];
        var oper_checked = false;
        opers.forEach(element => {
            if(element == check) {
                oper_checked = true;
            }
        });
        return oper_checked;
    }
</script>
<script src="../model/script.js"></script>
</html>